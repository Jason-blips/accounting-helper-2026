# 本地运行与登录说明

## 为什么「一键启动 + 打开 localhost:8000」登录时用的不是本地数据库？

**原因：**  
你本地打的**前端包**里，API 地址是在**构建时**写死的。

- 构建时如果存在 **`.env.production`** 且里面有 `VITE_API_URL=https://...`（例如 Render 或 app.jiangluo.uk），那打包出来的 JS 里 **所有请求都会发到那个地址**。
- **一键启动**会执行 `npm run build`，会读 `.env.production`，所以复制到后端的静态资源里已经带着「线上 API 地址」。
- 你打开 **http://localhost:8000** 时：**页面**是本机后端提供的，但页面里的 **登录、列表等请求** 仍然发往 `.env.production` 里配置的线上地址。
- 所以：**校验用户名密码的是线上那台服务器和它的数据库**，不是你本机的 `database/accounting.db`。  
  线上库没有你的 admin / 本地密码，或因 CORS/网络失败，就会表现为「本地无法登录」。

**JWT 鉴权本身没有关掉登录接口**：`/api/auth/login` 是放行的，登录请求会正常到达「你请求的那台后端」；  
问题在于：**你请求的是线上后端，不是本机后端**，所以没用上本地数据库。

---

## 想用「本地数据库」登录，该怎么做？

### 方式一：用前端开发模式（推荐）

这样前端不会读 `.env.production`，请求会走 **相对路径 /api**，由 Vite 代理到本机后端，用的就是本地库。

1. **先启动本机后端**（用本地库）  
   - 在 **backend-java** 下运行 **start.bat**（或根目录只启动后端的脚本）。

2. **再起前端开发服务器**  
   - 在 **frontend** 下执行：`npm run dev`  
   - 浏览器打开：**http://localhost:3000**

3. 在登录页用你**本地数据库**里的账号（如 admin / admin123）登录即可。  
   此时请求是：`localhost:3000` → 代理到 `localhost:8000/api` → 本机 Spring Boot → 本机 `database/accounting.db`。

### 方式二：让「一键启动 + localhost:8000」也用本地接口

希望继续用 一键启动、且浏览器只开 **http://localhost:8000**，又要用本地数据库，需要让**这次构建**不要用线上 API 地址：

1. **临时改掉或清空生产环境 API**  
   - 在 **frontend** 下：  
     - 要么把 **`.env.production`** 里的 `VITE_API_URL` 删掉或注释掉；  
     - 要么重命名 `.env.production`（例如改成 `.env.production.bak`），让这次构建不读它。

2. **再执行一键启动**  
   - 这样 `npm run build` 时没有 `VITE_API_URL`，前端会使用 **`/api`**（相对路径），  
   - 打开 **http://localhost:8000** 时，请求会发到同一台机器的 **http://localhost:8000/api**，用的就是本机后端和本地数据库。

3. **用完本地调试后**  
   - 若还要打包给线上或 App，再把 `.env.production` 改回 `VITE_API_URL=https://...` 并重新构建。

---

## 小结

| 你打开的是           | 构建时用的 API 配置        | 登录请求发到哪       | 校验的是哪份库     |
|----------------------|----------------------------|------------------------|--------------------|
| localhost:3000 (dev) | 无 / 开发默认              | localhost:8000/api     | 本地 accounting.db |
| localhost:8000       | 有 .env.production 的 URL | 线上（Render 等）     | 线上服务器的库     |
| localhost:8000       | 无 VITE_API_URL            | localhost:8000/api     | 本地 accounting.db |

**结论：**  
不是 JWT 鉴权导致本地不能登录，而是**当前页面发请求的那台后端不是本机**。  
要用本地数据库登录：要么用 **localhost:3000 + npm run dev**，要么构建前**不设** `VITE_API_URL` 再 一键启动、用 localhost:8000。
