# 自定义域名无法访问排查（Render + Cloudflare）

当 **https://accounting-helper.onrender.com** 能访问，但换成自己的域名（如 `https://app.你的域名.com`）不能访问时，按下面步骤检查。

---

## 1. CNAME 目标必须正确

你的 CNAME 记录要把**子域名**指到 Render 提供的**标准主机名**，不能是别的。

- **正确**：Target = `accounting-helper.onrender.com`（和你浏览器里能打开的那个地址一致，只是去掉 `https://`）
- **错误**：`accounting-helper-202...`、`accounting-helper-3000`、带端口、带路径等

在 Cloudflare（或你的 DNS 服务商）里：

- **Name**：`app`（表示 `app.你的域名.com`）
- **Target**：`accounting-helper.onrender.com`
- **Proxy**：Proxied 或 DNS only 均可（见下文 SSL 说明）

改完后等几分钟让 DNS 生效。

---

## 2. 必须在 Render 里添加自定义域名

只在 DNS 里加 CNAME 不够，Render 只接受「在控制台里添加过的」域名。

1. 打开 [Render Dashboard](https://dashboard.render.com/)
2. 进入你的 Web Service（accounting-helper）
3. 左侧 **Settings** → **Custom Domains**
4. 点 **Add Custom Domain**，输入：`app.你的域名.com`
5. Render 会显示它期望的 CNAME 目标（应为 `accounting-helper.onrender.com`），和你 DNS 里填的保持一致
6. 等待 Render 校验通过（可能几分钟），状态变为 **Verified**

若这里没添加该域名，即使 DNS 指对了，访问自定义域名也会失败。

---

## 3. Cloudflare SSL 模式（若开了 Proxied）

若 CNAME 在 Cloudflare 上是 **Proxied**（橙色云）：

1. Cloudflare 控制台 → **SSL/TLS** → **Overview**
2. 加密模式选 **Full** 或 **Full (strict)**，不要用 **Flexible**

否则 Cloudflare 到 Render 这一段可能不用 HTTPS，导致证书或重定向异常，表现为「换域名就不能用」。

---

## 4. 前端 API 地址要跟实际访问的域名一致

如果你希望用户通过 **https://app.你的域名.com** 访问（同一域名既提供页面又提供接口）：

1. 后端已通过 CNAME + Render 自定义域名暴露在 `https://app.你的域名.com`
2. 前端构建时要指向这个地址，例如在 **frontend** 的 `.env.production` 里：
   ```env
   VITE_API_URL=https://app.你的域名.com/api
   ```
3. 再执行 `npm run build` 并部署/复制到后端静态资源

这样前端的请求会发到你的域名，和「用 Render 直连」时只是域名不同，行为一致。后端 CORS 已按请求的 `Origin` 动态返回，任意合法域名都可访问。

---

## 5. 小结检查清单

| 检查项 | 说明 |
|--------|------|
| CNAME Target | 必须是 `accounting-helper.onrender.com`，不能是其它主机名或带端口 |
| Render Custom Domains | 在 Render 该服务的 Settings → Custom Domains 里已添加 `app.你的域名.com` 并显示 Verified |
| Cloudflare SSL | 若开 Proxied，SSL 模式为 Full 或 Full (strict) |
| 前端 VITE_API_URL | 若用自定义域名访问，构建时 `VITE_API_URL` 设为 `https://app.你的域名.com/api` |

按上述修正后，用 `https://app.你的域名.com/login` 应能正常打开并登录。
