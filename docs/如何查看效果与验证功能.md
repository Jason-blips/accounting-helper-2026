# 如何查看当前效果，并验证每个功能能否运行

## 一、先让项目跑起来（看到界面）

### 方式 1：网页效果（推荐，最简单）

1. **若要看最新功能（分享图、还款周期、交易记录列表修复），先更新前端再启动**
   - 在**项目根目录**双击运行 **`build-frontend-and-copy.bat`**（会执行 `npm run build` 并把结果拷到后端的 static）
   - 然后再启动后端（见下一步）
   - 若跳过此步，页面可能是旧版本，导航里没有「分享图」「还款周期」或交易记录仍为空。

2. **启动后端（同时提供网页和接口）**
   - 进入目录：`backend-java`
   - 双击运行 **`start.bat`**
   - 等待出现类似：`Started CountingHelperApplication`、`Tomcat started on port(s): 8000`

3. **在浏览器打开**
   - 地址栏输入：**http://localhost:8000**
   - 应看到登录页；登录后可看到概览、交易、**分享图**、**还款周期**等页面

4. **看「手机版」效果（同一套代码）**
   - 在浏览器按 **F12** 打开开发者工具
   - 点击 **「切换设备工具栏」** 图标（或 Ctrl+Shift+M），选择设备如 iPhone 12 / Pixel 5
   - 刷新页面，即可看到小屏布局、汉堡菜单等效果

### 方式 2：前端开发模式（改代码即时看效果）

1. **先启动后端**（同上）：在 `backend-java` 下运行 `start.bat`
2. **再启动前端开发服务器**：
   ```bash
   cd frontend
   npm install   # 首次需要
   npm run dev
   ```
3. 浏览器打开 **http://localhost:3000**，修改前端代码会热更新

### 方式 3：在手机上 / 模拟器里看 App 效果

1. 确保后端已部署到**公网 HTTPS**，或同一 WiFi 下用电脑 IP 访问（需后端允许）。
2. 在 `frontend` 下配置 API 地址后打包并同步到 Android：
   ```bash
   cd frontend
   # 若后端在本地且用电脑 IP，例如：
   # set VITE_API_URL=http://192.168.x.x:8000/api  然后 build:app
   npm run build:app
   npx cap sync
   npm run cap:android
   ```
3. 在 Android Studio 里选择模拟器或真机，点击 Run，即可在设备上看到 App 效果。

---

## 二、按功能逐项自测（确认每个功能能跑）

在 **http://localhost:8000** 登录后，按下面顺序在页面上操作即可验证。

| 序号 | 功能 | 怎么验证 | 预期 |
|------|------|----------|------|
| 1 | 注册 | 登录页点「注册」→ 填用户名/密码（邮箱可选）→ 提交 | 注册成功并跳转到概览或提示登录 |
| 2 | 登录 | 输入已有账号密码 → 登录 | 进入概览页，顶部有导航 |
| 3 | 概览 | 进入首页，看统计卡片和图表 | 显示总收入、总支出、余额及趋势图 |
| 4 | 添加交易 | 点「添加交易」→ 选收入/支出、金额、币种等 → 提交 | 提示成功并可在交易记录中看到 |
| 5 | 交易记录 | 点「交易记录」 | 列表展示所有交易，可按日期筛选 |
| 6 | 编辑交易 | 在交易列表点某条「编辑」→ 改金额等 → 保存 | 列表更新为修改后内容 |
| 7 | 删除交易 | 在交易列表点某条「删除」→ 确认 | 该条从列表消失 |
| 8 | 多币种 | 添加交易时选不同币种（GBP/CNY/USD/EUR） | 能保存并在概览/列表中正确显示 |
| 9 | AI 分析 | 点「AI分析」→ 选择周期 → 提交 | 返回分析文案（未配置 OpenAI 时为基础分析） |
| 10 | 关于 | 点导航「关于」 | 显示版本、应用 ID、可选隐私链接 |
| 11 | 退出登录 | 点「退出登录」→ 确认 | 回到登录页 |
| 12 | 离线提示 | 断网或关闭后端后刷新/操作 | 顶部出现黄色「当前处于离线状态」条 |
| 13 | 接口错误提示 | 后端未启动时在前端做任意需请求的操作 | 顶部出现红色「无法连接服务器」条 |
| 14 | 分享图 | 点「分享图」→ 选当天/一周/一月 → 生成图片 → 保存或分享 | 可下载 PNG 或调起系统分享 |
| 15 | 还款周期 | 点「还款周期」→ 设置还款日（如每月 15 号）→ 查看各周期收支、设置预期、生成分享图 | 周期按还款日划分；可点「查看明细」按周期看交易（需先执行数据库迁移，见下方） |

**管理员账号额外可测：**

| 功能 | 怎么验证 | 预期 |
|------|----------|------|
| 用户管理 | 用管理员账号登录 → 点「用户管理」 | 能看到用户列表、统计、删除用户等 |
| 性能监控 | 点「性能监控」 | 页面存在；若后端未实现 `/api/performance` 会报错，属预期（仅前端页） |

---

## 三、接口是否正常（可选）

- 在浏览器访问：**http://localhost:8000/api/health**  
  - 若返回 `{"status":"healthy"}` 说明后端和路由正常。
- 更完整的接口清单与示例请求，见：**backend-java/功能验证清单.md**（用 Postman 或 curl 按项测）。

---

## 四、常见问题

- **打开 http://localhost:8000 没页面或 404**  
  - 确认是用 `start.bat` 启动的（会先执行 `mvn package` 再启动），且启动日志里没有报错。

- **登录后一直转圈或报错**  
  - 看浏览器 F12 → Network：请求是否发到 `http://localhost:8000/api/...` 且返回 200。  
  - 看后端控制台是否有报错；数据库路径是否正确（默认 `../database/accounting.db`）。

- **移动端菜单没出现**  
  - 把浏览器窗口**拉窄**到约 768px 以下，或使用 F12 设备模拟选手机，再刷新页面。

- **App 里打不开或接口失败**  
  - 确认手机和电脑在同一 WiFi，且 `VITE_API_URL` 指向的地址在手机可访问（如 `http://电脑IP:8000/api`）；生产环境需用 HTTPS。

- **还款周期页报错或无法加载**  
  - 需先执行一次数据库迁移，见 **database/migration_billing_cycle.sql**（在项目根目录执行：`sqlite3 database/accounting.db < database/migration_billing_cycle.sql`，或使用 SQLite 工具执行该文件中的 SQL）。

- **总收支有数但「交易记录」显示暂无记录**  
  - **先确认数据库里是否有该用户的交易**：浏览器访问 **http://localhost:8000/api/transaction-info**。返回里 `transactionCount` 为 user_id=1 的交易笔数（当前未启用鉴权时接口按 userId=1 查）；若为 0 说明库里没有该 user_id 的交易。  
  - **再确认库里的 user_id 是否与登录用户一致**：用 SQLite 执行 **database/check_transactions.sql**（在项目根目录执行：`sqlite3 database/accounting.db < database/check_transactions.sql`），看「按用户统计」和「用户列表」里 id 与 user_id 是否对应；若交易都是别的 user_id，需把该 user_id 改为你登录用户的 id，或用对应用户登录。  
  - 若 `transactionCount` 大于 0 但页面仍空，多半是前端未用最新构建（需重新 `npm run build` 并刷新）。

按上述步骤即可**看到当前效果**，并**逐项确认每个功能是否能运行**。

---

## 五、页面显示「加载失败」或想用之前的数据库

- 页面上会显示简要原因（如网络异常、服务器错误），可点 **「重试」** 再试一次。  
- 若怀疑是数据库路径或备份恢复问题，请查看：**docs/数据库恢复与使用之前的数据库.md**（如何放入之前的 `accounting.db`、如何指定路径、如何排查）。
