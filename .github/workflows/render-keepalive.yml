# Render 免费版保活：定时请求后端，避免服务休眠
# 使用前在仓库 Settings → Secrets and variables → Actions 中添加 RENDER_APP_URL
# 值为后端根地址，例如 https://your-app.onrender.com（不要带 /api 或末尾斜杠）
name: Render Keep-Alive

on:
  schedule:
    # 每 14 分钟执行一次（Render 约 15 分钟无请求会休眠）
    - cron: '*/14 * * * *'
  workflow_dispatch: # 允许手动触发测试

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Render backend
        run: |
          URL="${{ secrets.RENDER_APP_URL }}"
          if [ -z "$URL" ]; then
            echo "::warning::RENDER_APP_URL secret 未设置，跳过保活请求。请在仓库 Settings → Secrets 中添加。"
            exit 0
          fi
          # 去掉末尾斜杠，请求 /api/ping（保活专用，返回 ok，无需登录）
          URL="${URL%/}/api/ping"
          echo "Requesting: $URL"
          curl -sf --max-time 60 "$URL" && echo " OK" || echo "::warning::请求失败或超时"
